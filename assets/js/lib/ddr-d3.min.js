!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.ddr_d3={})}(this,function(t){"use strict";var e=function(t,e){var n=t,i=e;this.getDistance=function(t){return Math.sqrt((this.getX()-t.getX())*(this.getX()-t.getX())+(this.getY()-t.getY())*(this.getY()-t.getY()))},this.getX=function(){return n},this.setX=function(t){n=t},this.getY=function(){return i},this.setY=function(t){i=t}},n=function(t,n,i,o){var g,r;"number"==typeof t&&"number"==typeof n&&"number"==typeof i&&"number"==typeof o?(g=new e(t,n),r=new e(t+i,n+o)):(g=t,r=n),this.getArea=function(){return this.getWidth()*this.getHeight()},this.containsRectangle=function(t){return t.getLeftX()>=this.getLeftX()&&t.getTopY()>=this.getTopY()&&t.getRightX()<=this.getRightX()&&t.getBottomY()<=this.getBottomY()},this.intersectsRectangle=function(t){return t.getRightX()>this.getLeftX()&&t.getBottomY()>this.getTopY()&&t.getLeftX()<this.getRightX()&&t.getTopY()<this.getBottomY()},this.setCenterX=function(t){var e=this.getWidth();g.setX(t-e/2),r.setX(t+e/2)},this.setCenterY=function(t){var e=this.getHeight();g.setY(t-e/2),r.setY(t+e/2)},this.merge=function(t){g.setX(Math.min(g.getX(),t.getP1().getX())),g.setY(Math.min(g.getY(),t.getP1().getY())),r.setX(Math.max(r.getX(),t.getP2().getX())),r.setY(Math.max(r.getY(),t.getP2().getY()))},this.getCenter=function(){return new e((this.getLeftX()+this.getRightX())/2,(this.getTopY()+this.getBottomY())/2)},this.getP1=function(){return g},this.getP2=function(){return r},this.getTopLeftPoint=function(){return g},this.getBottomRightPoint=function(){return r},this.getX=function(){return g.getX()},this.setX=function(t){var e=this.getWidth();return g.setX(t),this.setWidth(e),this},this.getY=function(){return g.getY()},this.setY=function(t){var e=this.getHeight();return g.setY(t),this.setHeight(e),this},this.getLeftX=function(){return g.getX()},this.getRightX=function(){return r.getX()},this.getTopY=function(){return g.getY()},this.getBottomY=function(){return r.getY()},this.getWidth=function(){return r.getX()-g.getX()},this.setWidth=function(t){return r.setX(g.getX()+t),this},this.getHeight=function(){return r.getY()-g.getY()},this.setHeight=function(t){return r.setY(g.getY()+t),this}};n.prototype.toString=function(){return"[Rectangle x1="+this.getLeftX()+",y1="+this.getTopY()+",x2="+this.getRightX()+",y2="+this.getBottomY()+",w="+this.getWidth()+",h="+this.getHeight()+"]"};var i=function(t,i,o,g){n.call(this,t,i,o,g),this.getDistanceToOrigin=function(t){return this.getDistanceToOtherPoint(new e(0,0),t)},this.getDistanceToOtherPoint=function(t,e){var n=this.getClosestPointToOtherPoint(t);return void 0!==e&&(n.setX(n.getX()*e[1]),n.setY(n.getY()*e[0])),n.getDistance(t)},this.getClosestPointToOtherPoint=function(t){var n=t.getX(),i=t.getY();return t.getX()<this.getLeftX()&&(n=this.getX()),t.getX()>this.getRightX()&&(n=this.getRightX()),t.getY()<this.getY()&&(i=this.getY()),t.getY()>this.getBottomY()&&(i=this.getBottomY()),new e(n,i)}};i.prototype=Object.create(n.prototype),i.prototype.constructor=i;var o={Point:e,Rectangle:n,Space:i},g=function(){function t(){return[1,1]}function o(t){for(var e=[],n=0;n<t.length;n++)for(var i=t[n],o=n+1;o<t.length;o++){var g=t[o];i.containsRectangle(g)?-1===e.indexOf(o)&&e.push(o):g.containsRectangle(i)&&-1===e.indexOf(n)&&e.push(n)}e.sort(function(t,e){return t-e});for(var r=e.length-1;r>=0;r--)t.splice(e[r],1);return t}function g(t,e){var i,o;return i=t.getLeftX()>=0?t.getLeftX():t.getRightX()<=0?t.getRightX()-e.getWidth():t.getLeftX()>-e.getWidth()/2?t.getLeftX():t.getRightX()<e.getWidth()/2?t.getRightX()-e.getWidth():-e.getWidth()/2,o=t.getTopY()>=0?t.getTopY():t.getBottomY()<=0?t.getBottomY()-e.getHeight():t.getTopY()>-e.getHeight()/2?t.getTopY():t.getBottomY()<e.getHeight()/2?t.getBottomY()-e.getHeight():-e.getHeight()/2,new n(i,o,e.getWidth(),e.getHeight())}function r(t,n){var o=[];if(n.getX()>t.getLeftX()){var g=new i(new e(t.getLeftX(),t.getTopY()),new e(n.getX(),t.getBottomY()));o.push(g)}if(n.getRightX()<t.getRightX()){var r=new i(new e(n.getRightX(),t.getTopY()),new e(t.getRightX(),t.getBottomY()));o.push(r)}if(n.getY()>t.getTopY()){var h=new i(new e(t.getLeftX(),t.getTopY()),new e(t.getRightX(),n.getY()));o.push(h)}if(n.getBottomY()<t.getBottomY()){var s=new i(new e(t.getLeftX(),n.getBottomY()),new e(t.getRightX(),t.getBottomY()));o.push(s)}return o}var h=[],s=0,u=0;return h.push(new n(-1e5,-1e5,2e5,2e5)),this.findPosition=function(t){for(var e=0;e<h.length;e++){var n=h[e];if(n.getWidth()>=t.getWidth()&&n.getHeight()>=t.getHeight())return g(n,t)}throw"No suitable space found"},this.place=function(e){for(var n=[],i=[],g=0;g<h.length;g++){var a=h[g];if(a.intersectsRectangle(e))for(var f=r(a,e),c=0;c<f.length;c++){var l=f[c];l.getWidth()>=u&&l.getHeight()>=s&&i.push(l)}else n.push(a)}i=o(i),h=n.concat(i),h.sort(function(e,n){return e.getDistanceToOrigin(t.call(this))-n.getDistanceToOrigin(t.call(this))})},this.ratio=function(e){return e.length?"function"==typeof e?(t=e,this):(t=function(t){return e},this):t},this.setMinHeight=function(t){return s=t,this},this.setMinWidth=function(t){return u=t,this},this},r=function(){function t(){return void 0===o&&e(),o}function e(){i=document.createElement("canvas"),i.width=h,i.height=s,o=i.getContext("2d")}var i,o,g=-100,r=-100,h=1600,s=300;this.setContext=function(t){o=t},this.getBoundingBoxFromCanvas=function(e,i,o,u){var a=t();a.translate(-g,-r),a.fillStyle="white",a.fillRect(g,r,h,s),a.fillStyle="red",a.font=u+" "+i+" "+o,a.fillText(e,0,0);for(var f=a.getImageData(g,r,h,s),c=Number.MAX_VALUE,l=Number.MAX_VALUE,d=-Number.MAX_VALUE,X=-Number.MAX_VALUE,Y=0;s>Y;Y++)for(var m=0;h>m;m++){var p=Y*h*4+4*m,B=p,v=f.data[B];B=p+1;var w=f.data[B];B=p+2;var x=f.data[B];B=p+3;f.data[B];if(255==v&&255!=w&&255!=x){var R=m+g,y=Y+r;c>R&&(c=R),l>y&&(l=y),R>d&&(d=R),y>X&&(X=y)}}return a.translate(g,r),new n(c+g,l+r,d-c,X-l)}},h=function(t){function e(t){return"function"==typeof t?t:function(){return t}}function i(t){return Math.sqrt(t.size)}function o(t){return"sans-serif"}function h(t){return"normal"}function s(t,e){return!1}function u(t,e){return t.size/4}function a(){return[1,1]}function f(t){return t.text}function c(t){throw"You need to define the wordcloud.draw(function(data))"}this.text=function(t){return arguments.length?(f=e(t),this):f},this.fontSize=function(t){return arguments.length?(i=e(t),this):i},this.fontWeight=function(t){return arguments.length?(h=e(t),this):h},this.fontFamily=function(t){return arguments.length?(o=e(t),this):o},this.margin=function(t){return arguments.length?(u=e(t),this):u},this.rotate=function(t){return arguments.length?(s=e(t),this):s},this.ratio=function(t){return arguments.length?(a=e(t),this):a},this.draw=function(t){if(0==arguments.length)throw"You need to define the wordcloud.draw(function(data))";return c=e(t),this},this.xPlacement=function(){return function(t){return t.boundingBox.getCenter().getX()-t.originalBoundingBox.getWidth()/2-t.originalBoundingBox.getX()}},this.yPlacement=function(){return function(t){return t.boundingBox.getCenter().getY()-t.originalBoundingBox.getHeight()/2-t.originalBoundingBox.getY()}},this.familyAccessor=function(){return function(t){return t.family}},this.weightAccessor=function(){return function(t){return t.weight}},this.layout=function(t){var e=(Date.now(),new r),l=Number.MAX_VALUE,d=Number.MAX_VALUE,X=t.map(function(t,g){return t.size=i.call(this,t,g),t.family=o.call(this,t,g),t.weight=h.call(this,t,g),t.rotate=s.call(this,t,g),t.margin=u.call(this,t,g),t.text=f.call(this,t,g),t.originalBoundingBox=e.getBoundingBoxFromCanvas(t.text,t.size+"px",t.family,t.weight),t.boundingBox=new n(0,0,t.originalBoundingBox.getWidth(),t.originalBoundingBox.getHeight()),t.rotate&&(t.boundingBox=new n(0,0,t.originalBoundingBox.getHeight(),t.originalBoundingBox.getWidth())),t}).sort(function(t,e){return l=Math.min(l,t.boundingBox.getWidth(),e.boundingBox.getWidth()),d=Math.min(d,t.boundingBox.getHeight(),e.boundingBox.getHeight()),e.size-t.size}),Y=new g;Y.setMinWidth(l).setMinHeight(d).ratio(a.call(this));for(var m=0;m<X.length;m++){var p=X[m],B=Y.findPosition(p.boundingBox);B.setX(B.getX()-p.margin).setY(B.getY()-p.margin).setWidth(B.getWidth()+2*p.margin).setHeight(B.getHeight()+2*p.margin),Y.place(B),p.boundingBox=B}c.call(this,X)}},s={Wordcloud:h,RectanglePacker:g},u=function(){var t="";return this.translate=function(e,n){var i="translate(";return i+=e,void 0!==n&&(i+=" "+n),i+=")",t+=i,this},this.rotate=function(e,n,i){var o="rotate(";return o+=e,void 0!==n&&(o+=" "+n),void 0!==i&&(o+=" "+i),o+=")",t+=o,this},this.getTransformString=function(){return t},this};u.prototype.toString=function(){return this.getTransformString()};var a={Transform:u,FontMetricsCalculator:r};t.geometry=o,t.layout=s,t.util=a});
